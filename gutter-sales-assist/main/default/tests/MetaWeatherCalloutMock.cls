global class MetaWeatherCalloutMock implements HttpCalloutMock {
    global HTTPResponse respond(HTTPRequest req) {
        HttpResponse response = new HttpResponse();
        response.setHeader('Content-Type', 'application/json');
        response.setStatusCode(200);

        String endpoint = req.getEndpoint().toLowerCase();
        if (endpoint.contains('search') && endpoint.contains('valid')) {
            response.setBody('[{"title":"New York","location_type":"City","woeid":12345,"latt_long":"40.71455,-74.007118"}]');
        } else if (req.getEndpoint().contains('12345')) {
            response.setBody('{"consolidated_weather":[{"id":5508014992785408,"weather_state_name":"Heavy Rain","weather_state_abbr":"hr","wind_direction_compass":"S","created":"2021-07-09T00:55:43.888808Z","applicable_date":"2021-07-08","min_temp":23.765,"max_temp":29.439999999999998,"the_temp":29.725,"wind_speed":5.781751653328562,"wind_direction":180.79670594541167,"air_pressure":1014.5,"humidity":69,"visibility":10.374413425594527,"predictability":77},{"id":6731598528512000,"weather_state_name":"Heavy Rain","weather_state_abbr":"hr","wind_direction_compass":"WNW","created":"2021-07-09T00:55:46.876258Z","applicable_date":"2021-07-09","min_temp":21.235,"max_temp":28.945,"the_temp":29.490000000000002,"wind_speed":8.719585067623745,"wind_direction":295.1638449662223,"air_pressure":1009.0,"humidity":72,"visibility":9.172992225403643,"predictability":77},{"id":5878273016856576,"weather_state_name":"Light Cloud","weather_state_abbr":"lc","wind_direction_compass":"NNW","created":"2021-07-09T00:55:49.881864Z","applicable_date":"2021-07-10","min_temp":21.439999999999998,"max_temp":28.145,"the_temp":28.85,"wind_speed":4.610199065558472,"wind_direction":345.48352144341663,"air_pressure":1015.0,"humidity":61,"visibility":13.296100771494473,"predictability":70},{"id":5769621350121472,"weather_state_name":"Light Rain","weather_state_abbr":"lr","wind_direction_compass":"SSW","created":"2021-07-09T00:55:52.849688Z","applicable_date":"2021-07-11","min_temp":22.42,"max_temp":26.619999999999997,"the_temp":25.43,"wind_speed":4.332356671812614,"wind_direction":192.2308867152774,"air_pressure":1020.5,"humidity":74,"visibility":7.512688399745486,"predictability":75},{"id":6526651748843520,"weather_state_name":"Showers","weather_state_abbr":"s","wind_direction_compass":"SSE","created":"2021-07-09T00:55:55.862296Z","applicable_date":"2021-07-12","min_temp":22.925,"max_temp":28.295,"the_temp":27.92,"wind_speed":3.936645126864445,"wind_direction":168.66892705275163,"air_pressure":1023.0,"humidity":73,"visibility":10.923394873936212,"predictability":73},{"id":4845670906200064,"weather_state_name":"Heavy Rain","weather_state_abbr":"hr","wind_direction_compass":"ESE","created":"2021-07-09T00:55:58.872679Z","applicable_date":"2021-07-13","min_temp":23.17,"max_temp":27.715,"the_temp":29.91,"wind_speed":4.201046886184681,"wind_direction":121.0,"air_pressure":1024.0,"humidity":77,"visibility":9.999726596675416,"predictability":77}],"time":"2021-07-08T23:25:54.762801-04:00","sun_rise":"2021-07-08T05:32:50.719188-04:00","sun_set":"2021-07-08T20:29:35.788909-04:00","timezone_name":"LMT","parent":{"title":"New York","location_type":"Region / State / Province","woeid":2347591,"latt_long":"42.855350,-76.501671"},"sources":[{"title":"BBC","slug":"bbc","url":"http://www.bbc.co.uk/weather/","crawl_rate":360},{"title":"Forecast.io","slug":"forecast-io","url":"http://forecast.io/","crawl_rate":480},{"title":"HAMweather","slug":"hamweather","url":"http://www.hamweather.com/","crawl_rate":360},{"title":"Met Office","slug":"met-office","url":"http://www.metoffice.gov.uk/","crawl_rate":180},{"title":"OpenWeatherMap","slug":"openweathermap","url":"http://openweathermap.org/","crawl_rate":360},{"title":"Weather Underground","slug":"wunderground","url":"https://www.wunderground.com/?apiref=fc30dc3cd224e19b","crawl_rate":720},{"title":"World Weather Online","slug":"world-weather-online","url":"http://www.worldweatheronline.com/","crawl_rate":360}],"title":"New York","location_type":"City","woeid":2459115,"latt_long":"40.71455,-74.007118","timezone":"US/Eastern"}');
        } else {
            response.setBody('[]');
        }

        return response;
    }
}
